\chapter{Introduction}

\section{Formula SAE}
Formula SAE is an international design competition founded by the Society of Automotive Engineers in 1980, in which university students develop, build and race an open-wheel, single seater race car.\\
In Europe, Formula Student Germany is the main governing body. It releases the rulebook \cite{fsg2020} that is used in all european competitions and it organizes the biggest event of the season.\\
During a Formula SAE competition, after the car has completed all techical and safety inspections, it partecipates to 4 types of events:
\begin{itemize}
    \item Skidpad: the car must complete two laps of a figure 8 track, sometimes on wet tarmac.
    \item Acceleration: the car must do a standing start and complete a straight 75m long track as fast as possible.
    \item Autocross: a twisty autocross circuit of length 1.5m must be completed in the least time.
    \item Endurance and efficiency: the car must race for a total length of 22km around an autocross track.
\end{itemize}
For each of the previous events, points are calculated based on the time taken to complete the race. For the Endurance event efficiency is also taken into account.
\subsection{E-Agle Trento}
E-Agle Trento Racing Team is the Formula SAE team of the University of Trento. The team was born in 2016, and since then it has realized three all-electric Formula SAE cars: Chimera, Chimera Evoluzione and Fenice. This thesis covers the developement on Fenice, with some references and comparisons with Chimera Evoluzione.

\section{Tractive System}
\begin{figure}[h]
    \centering
    \input{pictures/tractive_system}
    \caption{Tractive system block schema}
    \label{fig:tractive_system}
\end{figure}
The tractive system is the whole high-voltage system of the car. It comprises the battery pack, the inverters and the electric motors that drive the wheels of the car.
Like Chimera Evoluzione, Fenice is powered by two independent three-phase permanent-magnet motors that drive the rear axle. Each motor is controlled by a motor controller that converts the direct current from the battery into a three-phase alternating current for the motors. By varying the output frequency and current, the controllers are able to define the motor's speed and torque.

\section{Batteries}
A battery is an electrical energy storage system that relies on chemical reactions to generate a voltage. The main properties of a battery are: nominal voltage, internal resistance, energy capacity and maximum discharge rate.\\
The voltage of a battery is influenced by many factors including: state of charge, temperature and applied load. The open-circuit voltage of a Lithium-Ion battery cell is 4.2V at 100\% state of charge and 3.0V at 0\%.
When a load is applied to a cell, the voltage drops according to Ohm's law: $V_{dropped} = R_{internal}*I_{load}$. The higher the current drawn, the higher the voltage drop. In high power applications, this phenomenon can significantly reduce the usable energy of the battery.

\subsection{Battery Pack}
A battery pack is a group of cells connected in series and parallel to increase the electrical characteristics of the pack. Arranging the cells in series means that the current will only travel down a single path, passing through every cell. In this case the voltage of the pack is equals to the sum of every series.\\
In a parallel arrangement, electrons travel down multiple paths, splitting the current across more cells. This increases the current output of the battery, but the potential across all cells is equalized.
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.4]{pictures/pack.png}
    \caption{3D model of Fenice's battery pack}
    \label{fig:pack}
\end{figure}
The structure of a battery pack is decided considering its specific application. For example, in an high power context, higher voltage batteries are more desirable because for the same power draw, less current is required, decreasing heat losses across conductors. In high current applications, more cells in parallel could be arranged, increasing the total energy storage and battery weight as a consequence.

As mentioned above, a Formula SAE car's battery should be sized to complete a 22km endurance course while also being able to output the maximum amount of power for the acceleration event. The battery should also be optimized for weight and have a low center of gravity. Furthermore, the rulebook limits maximum voltage to 600V \cite[EV 4.1.1]{fsg2020} and power to 80kW \cite[EV 2.2.1]{fsg2020}, so the resulting battery will have as many cells in series as permitted and as few parallels as needed to reach the required power and capacity target.\\
Fenice's battery features 108 cells in series and 4 in parallel (108s4p), for a total of 432 cells and a nominal voltage of 388.8V. Higher voltages could be reached by rewiring the pack in a 144s3p configuration, but the pack would have a maximum voltage of 604.8V, exceeding the 600V limit. Adding more cells leads to increased weight, volume and excess of capacity.
The high power requirement of the pack is fullfilled by the use of high-discharge rate cells, amounting to 45A in Fenice's case. This results in a total output of 180A of continuous discharge current. As a consequence, The maximum theoretical power output of the whole pack approaches 70kW and the energy capacity amounts to 6.2kWh.

\subsubsection{Naming hierarchy}

\begin{figure}[h]
    \centering
    \input{pictures/naming}
    \caption{Battery pack elements naming scheme}
    \label{fig:naming}
\end{figure}
As explained in figure \ref{fig:naming}, the pack is subdivided in physical blocks that can be summarised as follows:

\begin{itemize}
    \item The \textbf{cell} is the basic unit of the pack.
    \item Four cells in parallel form a \textbf{module} (also called cell, since the voltage is the same as a single cell).
    \item \textbf{Blocks} are a series of three modules, held together to form an actual block.
    \item The rulebook requires the separation of the pack into \textbf{segments} with precise physical and electrical characteristics \cite[EV 5.3.2]{fsg2020}. In this case a segment is a series of six blocks, totaling a maximum voltage of 75.6V ($4.2V*3\ modules*6\ blocks$) and 1.2kWh of energy, below the limit of 120V and 1.6 kWh mandated by the rules.
    \item In conclusion, the whole \textbf{pack} is composed of six segments connected in series.
\end{itemize}

\subsection{Internal Connections}
To be able to safely shut off the output of the battery pack, two normally-open Accumulator Isolation Relays (AIR) \cite[EV 5.6]{fsg2020} are located at both poles of the pack and are able to disconnect the battery from the outside of the battery container. These relays are controlled by the BMS and can also be switched off by external devices such as emergency buttons and sensors located around the car. In case of short-circuits, a fuse is also present between the negative contact and the input of the negative AIR.
\begin{figure}[h]
    \centering
    \input{pictures/tractive_system_detail}
    \caption{Tractive system schema}
    \label{fig:tractive_system_detail}
\end{figure}
\subsubsection{Precharge}
If the power-on procedure of the pack simply involved putting both AIRs to their closed position, a potentially dangerous in-rush current would charge the capacitors on the inverters very quickly. To control prevent overcurrent, the precharge procedure is performed.
First, the negative AIR together with $S_p$ is closed. This operation creates an alternative circuit that has $R_p$ as the current-limiting resistor. After $Bus$ and $BAT$ voltages have equalized, the positive AIR can finally be closed. This completes the precharge procedure and the battery is ready to be used.

\subsection{Battery Management Hardware}
The need to measure a large amount of voltages and temperatures scattered around the battery pack leads to a decentralized structure for the BMS components. Two types of logic boards are involved, namely the \textbf{Mainboard} and the \textbf{Cellboard}.\\
\begin{figure}[h]
    \centering
    \input{pictures/hierarchy}
    \caption{BMS hierarchy}
    \label{fig:bms_hierarchy}
\end{figure}

\subsubsection{Mainboard}
%\begin{figure}[h]
%    \centering
%    \includegraphics[scale=0.5]{pictures/mainboard.jpg}
%    \caption{Mainboard PCB}
%    \label{fig:mainboard}
%\end{figure}
The Mainboard is the central control unit of the BMS. It consists of a microcontroller that handles the pre-charge circuit, two CAN-bus lines and peripherals such as ADCs, EEPROMs and more. The mainboard is responsible for the actuation of the AIRs and contains the precharge circuit. It also handles communication with the rest of the car about the battery status, warnings and errors.

\subsubsection{Cellboard}
There are a total of six cellboards on Fenice's battery pack, one for every battery segment. Cellbaords are dedicated to the measurement of module voltages and cell temperatures. The reading of voltages is handled by a specialized battery management chip that communicates via SPI to the on-board microcontroller. Temperatures are acquired with sensors glued to the cells. All the data collected from the boards is sent via an internal CAN-bus to the mainboard.\
Cellboards are also in control of cell balancing. They can activate and deactivate discharging for any module through the battery management chip, depending on commands from the mainboard.

\section{Issues}
\subsection{Battery Management}
Battery management is a collection of operations that ensure the safety and efficiency of the battery pack's functioning.\\
A battery management system should constantly measure cell temperatures and voltages along with the total pack current output and check that each of those values is within specification. If anomalies are detected, the battery should be disconnected immediately.\\
Advanced BMS implementations communicate their state of operation with other devices, and turn the battery on or off according to external signals.\\
Moreover, during battery charging, the BMS should handle the charge current curve to maximize charging speed while keeping the battery in a safe state.\\
As the consequences of software errors on the BMS are potentially catastrophic, the code must adhere to strict standards and should be tested thoroughly. Furthermore, a reliable error management should be present to abide to the rulebook and to ease troubleshooting.

\subsection{Module Balancing}
Cells are not perfectly identical and can have slight variations in internal resistance between each other. These differences mean that after some use, modules can start to deviate in voltage between one another. If a cell has an higher voltage than average, the pack can only be charged to the voltage of said cell, while the remaining modules don't get fully charged. The same applies during discharge: if a module is more discharged than others, it constraints the maximum depth of discharge to when it reaches its cutoff voltage, while other cells are still above it and could theoretically be discharged further.\\
This issue limits the maximum energy storage available for use, reducing the car's range.

